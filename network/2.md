ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/sunmi.com/orderers/orderer.sunmi.com/msp/tlscacerts/tlsca.sunmi.com-cert.pem
CORE_PEER_LOCALMSPID="OrdererSunmiMSP"
CORE_PEER_TLS_ROOTCERT_FILE=$ORDERER_CA
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/sunmi.com/orderers/orderer.sunmi.com/msp
peer channel fetch config 0_block.pb -o orderer.sunmi.com:7050 -c "systemchain" --tls --cafile $ORDERER_CA


CORE_PEER_LOCALMSPID=OrgFarmerMSP
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/farmer.com/peers/peer0.farmer.com/tls/server.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/farmer.com/peers/peer0.farmer.com/tls/server.key
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/farmer.com/peers/peer0.farmer.com/tls/ca.crt
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/farmer.com/users/Admin@farmer.com/msp
CORE_PEER_ADDRESS=peer0.farmer.com:7051

peer channel create -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/businesschain.tx --tls --cafile $ORDERER_CA

peer channel fetch 0 businesschain.block -o orderer.sunmi.com:7050 -c "businesschain" --tls --cafile $ORDERER_CA

peer channel join -b businesschain.block

peer channel update -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/FarmerMSPanchors.tx --tls --cafile $ORDERER_CA

peer chaincode install -n Distributor_Shipper_Farmer -v 1 -p github.com/chaincode/distributor-shipper-farmer/go

CORE_PEER_LOCALMSPID=OrgDistributorMSP
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/distributor.com/peers/peer0.distributor.com/tls/server.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/distributor.com/peers/peer0.distributor.com/tls/server.key
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/distributor.com/peers/peer0.distributor.com/tls/ca.crt
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/distributor.com/users/Admin@distributor.com/msp
CORE_PEER_ADDRESS=peer0.distributor.com:7051
peer channel join -b businesschain.block
peer channel update -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/DistributorMSPanchors.tx --tls --cafile $ORDERER_CA
peer chaincode install -n Distributor_Shipper_Farmer -v 1 -p github.com/chaincode/distributor-shipper-farmer/go

CORE_PEER_LOCALMSPID=OrgShipperMSP
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/shipper.com/peers/peer0.shipper.com/tls/server.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/shipper.com/peers/peer0.Shipper.com/tls/server.key
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/shipper.com/peers/peer0.shipper.com/tls/ca.crt
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/shipper.com/users/Admin@shipper.com/msp
CORE_PEER_ADDRESS=peer0.shipper.com:7051
peer channel join -b businesschain.block
peer channel update -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/ShipperMSPanchors.tx --tls --cafile $ORDERER_CA
peer chaincode install -n Distributor_Shipper_Farmer -v 1 -p github.com/chaincode/distributor-shipper-farmer/go

CORE_PEER_LOCALMSPID=OrgWholesalerMSP
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/wholesaler.com/peers/peer0.wholesaler.com/tls/server.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/wholesaler.com/peers/peer0.wholesaler.com/tls/server.key
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/wholesaler.com/peers/peer0.wholesaler.com/tls/ca.crt
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/wholesaler.com/users/Admin@wholesaler.com/msp
CORE_PEER_ADDRESS=peer0.wholesaler.com:7051
peer channel join -b businesschain.block
peer channel update -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/WholesalerMSPanchors.tx --tls --cafile $ORDERER_CA
peer chaincode install -n Distributor_Shipper_Farmer -v 1 -p github.com/chaincode/distributor-shipper-farmer/go

CORE_PEER_LOCALMSPID=OrgRetailerMSP
CORE_PEER_TLS_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/retailer.com/peers/peer0.retailer.com/tls/server.crt
CORE_PEER_TLS_KEY_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/retailer.com/peers/peer0.retailer.com/tls/server.key
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/retailer.com/peers/peer0.retailer.com/tls/ca.crt
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/retailer.com/users/Admin@retailer.com/msp
CORE_PEER_ADDRESS=peer0.retailer.com:7051
peer channel join -b businesschain.block
peer channel update -o orderer.sunmi.com:7050 -c businesschain -f ./channel-artifacts/RetailerMSPanchors.tx --tls --cafile $ORDERER_CA
peer chaincode install -n Distributor_Shipper_Farmer -v 1 -p github.com/chaincode/distributor-shipper-farmer/go


peer chaincode instantiate -o orderer.sunmi.com:7050 -C businesschain -n Distributor_Shipper_Farmer -v 1 -c '{"Args":[]}' -P "OR('OrgFarmerMSP.member', AND('OrgDistributorMSP.member', 'OrgShipperMSP.member'))" --collections-config  /opt/gopath/src/github.com/chaincode/distributor-shipper-farmer/collections_config.json --tls --cafile $ORDERER_CA



ORDERER_CA=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/sunmi.com/orderers/orderer.sunmi.com/msp/tlscacerts/tlsca.sunmi.com-cert.pem
FARMER_TLS_ROOT_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/farmer.com/peers/peer0.farmer.com/tls/ca.crt
DISTRIBUTOR_TLS_ROOT_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/distributor.com/peers/peer0.distributor.com/tls/ca.crt
SHIPPER_TLS_ROOT_CERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/shipper.com/peers/peer0.shipper.com/tls/ca.crt
peer chaincode invoke -o orderer.sunmi.com:7050 --tls --cafile $ORDERER_CA                      \
 -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["newFruitTx", "8", "西瓜","温热","12 cny/kg","2000 kg","9"]}'          \
 --peerAddresses peer0.farmer.com:7051 --tlsRootCertFiles $FARMER_TLS_ROOT_CERT_FILE            \
 --peerAddresses peer0.distributor.com:7051 --tlsRootCertFiles $DISTRIBUTOR_TLS_ROOT_CERT_FILE  \
 --peerAddresses peer0.shipper.com:7051 --tlsRootCertFiles $SHIPPER_TLS_ROOT_CERT_FILE

peer chaincode invoke -o orderer.sunmi.com:7050 --tls --cafile $ORDERER_CA                      \
 -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["newFruitTx", "2", "西瓜","温热","12 cny/kg","2000 kg","9"]}'          \
 --peerAddresses peer0.farmer.com:7051 --tlsRootCertFiles $FARMER_TLS_ROOT_CERT_FILE
 
 
peer chaincode invoke -o orderer.sunmi.com:7050 --tls --cafile $ORDERER_CA                      \
 -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["newFruitTx", "1", "西瓜","温热","12 cny/kg","2000 kg","9"]}'          \
 --peerAddresses peer0.distributor.com:7051 --tlsRootCertFiles $DISTRIBUTOR_TLS_ROOT_CERT_FILE  \
 --peerAddresses peer0.shipper.com:7051 --tlsRootCertFiles $SHIPPER_TLS_ROOT_CERT_FILE
 
peer chaincode invoke -o orderer.sunmi.com:7050 --tls --cafile $ORDERER_CA                      \
 -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["newFruitTx", "8", "西瓜","温热","12 cny/kg","2000 kg","9"]}'          \
 --peerAddresses peer0.shipper.com:7051 --tlsRootCertFiles $SHIPPER_TLS_ROOT_CERT_FILE
  

peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["readFruitTx","2"]}'  \
 --peerAddresses peer0.farmer.com:7051 --tlsRootCertFiles $FARMER_TLS_ROOT_CERT_FILE              

peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["readFruitTx","3"]}'  \
 --peerAddresses peer0.distributor.com:7051 --tlsRootCertFiles $DISTRIBUTOR_TLS_ROOT_CERT_FILE  

peer chaincode install \
    -n Distributor_Shipper_Farmer \
    -v 1.0.4 \
    -p github.com/chaincode/distributor-shipper-farmerV1.0.4/go 

peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["getFruitTxByRange","",""]}' \
 --peerAddresses peer0.shipper.com:7051 --tlsRootCertFiles $SHIPPER_TLS_ROOT_CERT_FILE
 
peer chaincode upgrade -n Distributor_Shipper_Farmer -v 1.0.4 \
               -c '{"Args":[]}' \
               -p github.com/chaincode/distributor-shipper-farmerV1.0.4/go -C businesschain \
               -o orderer.sunmi.com:7050            \
               -P "OR(AND('OrgFarmerMSP.member', 'OrgDistributorMSP.member'), 'OrgShipperMSP.member')"   \
               --collections-config  /opt/gopath/src/github.com/chaincode/distributor-shipper-farmerV1.0.4/collections_config.json \
               --tls --cafile $ORDERER_CA 


peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["newFunction102"]}'
peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["GetID"]}'
peer chaincode query -C businesschain -n Distributor_Shipper_Farmer -c '{"Args":["GetMSPID"]}' \
 --peerAddresses peer0.distributor.com:7051 --tlsRootCertFiles $DISTRIBUTOR_TLS_ROOT_CERT_FILE


